<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="cn" lang="cn">
<head>
  <link href="//gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.49" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>postgreSQL 日期函数整理 &middot; Gravel</title>

  
  <link type="text/css" rel="stylesheet" href="https://leongravel.com/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="https://leongravel.com/css/poole.css">
  <link type="text/css" rel="stylesheet" href="https://leongravel.com/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="https://leongravel.com/css/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  <link href="" rel="alternate" type="application/rss+xml" title="Gravel" />

  
</head>

  <body class=" ">
  <aside class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://leongravel.com/"><h1>Gravel</h1></a>
      <p class="lead">
       A Empty-Stack Developer.
      </p>
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li><a href="https://leongravel.com/">Home</a> </li>
        <li><a href="/posts/"> Posts </a></li><li><a href="/portfolio/"> Portfolio </a></li><li><a href="/about/about"> About </a></li>
      </ul>
    </nav>

    <p>&copy; 2018. All rights reserved. </p>
  </div>
</aside>

    <main class="content container">
    <div class="post">
  <h1>postgreSQL 日期函数整理</h1>
  <time datetime=2018-03-19T21:18:41Z class="post-date">Mon, Mar 19, 2018</time>
  

<p>最近在项目中维护某一张表的固定数据的时候，经常会用到postgreSQL的各种日期函数，所以简单整理一下。<!-- more --></p>

<h2 id="获取系统时间的函数">获取系统时间的函数</h2>

<h3 id="获取当前完整时间">获取当前完整时间</h3>

<ul>
<li>通过now()获取的时间是最完整的时间，包括时区，秒也保留到了6位小数。
<code>
select now();
-- 得到如下结果
'2018-03-19 21:28:31.545145+08'
</code></li>

<li><p>current_timestamp 效果是和now()一样的。</p>

<pre><code>select current_timestamp效果是和now;
-- 得到如下结果
'2018-03-19 21:29:31.545145+08'
</code></pre>

<h3 id="获取当前时间">获取当前时间</h3></li>

<li><p>current_time 只显示当前的时间，不包括日期</p>

<pre><code>select current_time;
--    得到的结果如下
   21:29:31.545145+08'
</code></pre>

<h3 id="获取当前日期">获取当前日期</h3></li>

<li><p>current_date 只显示当前的日期，不包括小时等信息</p>

<pre><code>select current_date;
--     得到的结果如下
   '2018-03-19'
</code></pre></li>
</ul>

<h2 id="日期计算函数">日期计算函数</h2>

<h3 id="日期简单的加减">日期简单的加减</h3>

<ol>
<li>一年后
<code>
select now() + interval '1 years';
select now() + interval '1 year'; 
select now() + interval '1 y';
select now() + interval '2 Y';
select now() + interval '2Y'; 
</code>
这几种写法都OK的。</li>
<li>一个月后
<code>
select now() + interval '1 month';
</code></li>
<li>一周后
<code>
select now() + interval '1 week';
</code></li>
<li>一天后
<code>
select now() + '1 day'
</code></li>
<li>一分钟后
<code>
select now() + '1 min';   
</code></li>
</ol>

<p>interval 可以不写，其值可以是：</p>

<table>
<thead>
<tr>
<th>Abbreviation</th>
<th>Meaning</th>
</tr>
</thead>

<tbody>
<tr>
<td>Y</td>
<td>Years</td>
</tr>

<tr>
<td>M</td>
<td>Months (in the date part)</td>
</tr>

<tr>
<td>W</td>
<td>Weeks</td>
</tr>

<tr>
<td>D</td>
<td>Days</td>
</tr>

<tr>
<td>H</td>
<td>Hours</td>
</tr>

<tr>
<td>M</td>
<td>Minutes (in the time part)</td>
</tr>

<tr>
<td>S</td>
<td>Seconds</td>
</tr>
</tbody>
</table>

<h3 id="计算时间差">计算时间差</h3>

<p>使用 age(timestamp, timestamp)计算时间差
函数描述：计算两个日期之间相隔多少天，单个参数时表示与当前日期(current_date)相比
参数：age(timestamp,timestamp),age(timestamp)
返回值：interval，两个日期之间的相隔天数</p>

<p>示例：</p>

<pre><code>Select age(timestamp '2001-04-10', timestamp '1957-06-13')
Result: 43 years 9 mons 27 days
</code></pre>

<h2 id="时间字段的截取">时间字段的截取</h2>

<p>在开发的过程中，有时候经常会用到日期的年，月，日，小时等值，PostgreSQL给我们 提供了一个非常便利的EXTRACT函数。</p>

<pre><code>EXTRACT(field FROM source)
</code></pre>

<p>field 表示取的时间对象，source 表示取的日期来源，类型为 timestamp、time 或 interval。
* 取年份</p>

<pre><code>select extract(year from now());
Result: 2018
</code></pre>

<ul>
<li>取月份
<code>
select extract(month from now());
Result: 3
select extract(day from timestamp '1994-08-20');
Result: 8
</code></li>
<li>查看今天是一年中的第几天
<code>
select extract(doy from now());
</code></li>
<li>查看现在距1970-01-01 00:00:00 UTC 的秒数
<code>
select extract(epoch from now());
</code></li>
<li>把epoch 值转换回时间戳
<code>
SELECT TIMESTAMP WITH TIME ZONE 'epoch' + 1369755555 * INTERVAL '1 second'; 
</code></li>
</ul>

<h2 id="结语">结语</h2>

<p>以上是基本的PG时间/日期函数使用，有些函数因为下班了，家里电脑没环境，没跑结果出来，明天补上。<code>（明日复明日。。明日何其多。。）</code></p>

<p>详细用法请参考：<a href="http://www.postgresql.org/docs/9.2/static/functions-datetime.html">PostgreSQL官方说明</a></p>

</div>

<h2>Comments</h2>
<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "leongravel" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </main>

    
  </body>
</html>
